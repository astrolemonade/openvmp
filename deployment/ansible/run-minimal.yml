---
- name: Run the minimal set of OpenVMP software on the target
  hosts: openvmp-pi

  tasks:
    # Drivers
    - name: Create the systemd service for the 'drivers' subsystem
      template:
        src: templates/systemd.service
        dest: /lib/systemd/system/openvmp-drivers.service
      vars:
        subsystem_name: drivers
        service_description: "OpenVMP subsystem: device drivers"
    - name: Launch the 'drivers' subsystem
      systemd:
        name: openvmp-drivers
        state: restarted
        enabled: true

    # Motion control
    - name: Create the systemd service for the 'motion_control' subsystem
      template:
        src: templates/systemd.service
        dest: /lib/systemd/system/openvmp-motion-control.service
      vars:
        subsystem_name: motion_control
        service_description: "OpenVMP subsystem: motion_control"
    - name: Launch the 'motion_control' subsystem
      systemd:
        name: openvmp-motion-control
        state: restarted
        enabled: true

    # Reflection
    - name: Create the systemd service for the 'reflection' subsystem
      template:
        src: templates/systemd.service
        dest: /lib/systemd/system/openvmp-reflection.service
      vars:
        subsystem_name: reflection
        service_description: "OpenVMP subsystem: reflection"
    - name: Launch the 'reflection' subsystem
      systemd:
        name: openvmp-reflection
        state: restarted
        enabled: true
